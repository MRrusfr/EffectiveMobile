# Задание 2: Маркетплейс — Управление товарами (Продавец)

## User Stories

### US-1: Создание карточки товара

**Как** Продавец,
**я хочу** создать карточку товара с названием, описанием, ценой и фотографиями,
**чтобы** покупатели могли найти мой товар на маркетплейсе.

**Критерии приёмки:**
- Обязательные поля: название, описание, цена, минимум 1 фотография
- Максимум 10 фотографий, формат JPG/PNG, размер до 5 МБ каждая
- Цена > 0, указывается в рублях
- Товар сохраняется в статусе «Черновик» после создания

---

### US-2: Сохранение черновика

**Как** Продавец,
**я хочу** сохранить товар как черновик,
**чтобы** я мог доработать его позже.

**Критерии приёмки:**
- Можно сохранить с неполными данными
- Черновик виден только продавцу
- Черновик можно редактировать неограниченное число раз

---

### US-3: Публикация товара

**Как** Продавец,
**я хочу** опубликовать черновик товара на маркетплейсе,
**чтобы** покупатели могли его увидеть.

**Критерии приёмки:**
- Все обязательные поля должны быть заполнены перед публикацией
- Товар проходит автоматическую модерацию
- Статус меняется: Черновик → На модерации → Опубликован
- Продавец получает уведомление о результате модерации

---

### US-4: Редактирование товара

**Как** Продавец,
**я хочу** отредактировать опубликованный товар,
**чтобы** обновить информацию о нём.

**Критерии приёмки:**
- Можно изменить любое поле (название, описание, цена, фотографии)
- Все обязательные поля должны быть заполнены перед публикацией
- Изменения проходят повторную модерацию
- До прохождения модерации покупателям отображается предыдущая версия

---

### US-5: Снятие товара с публикации

**Как** Продавец,
**я хочу** снять товар с публикации,
**чтобы** покупатели больше не могли его приобрести.

**Критерии приёмки:**
- Товар скрывается из каталога для покупателей
- Продавец может повторно опубликовать товар
- История товара сохраняется
- Существующие заказы не отменяются

---

## Состояния товара и переходы

| # | Состояние | Описание | Допустимые переходы |
|---|-----------|----------|---------------------|
| 1 | Черновик (Draft) | Создан, не опубликован | → На модерации |
| 2 | На модерации (Pending Moderation) | Отправлен на проверку | → Опубликован / → Отклонён |
| 3 | Опубликован (Published) | Виден покупателям в каталоге | → На модерации (при редактировании) / → Снят с публикации |
| 4 | Отклонён (Rejected) | Не прошёл модерацию | → Черновик (при редактировании) |
| 5 | Снят с публикации (Unpublished) | Скрыт продавцом | → На модерации (при повторной публикации) |

> Визуальная диаграмма состояний представлена на странице 2 файла `task2_userstory_usecase.drawio`.

---

## Спецификации вариантов использования

---

### UC-1: Создание карточки товара

| Поле | Значение |
|------|----------|
| **ID** | UC-1 |
| **Название** | Создание карточки товара |
| **Основной актор** | Продавец (Seller) |
| **Дополнительные акторы** | — |
| **Приоритет** | Высокий |
| **Связанная User Story** | US-1 |

#### Предусловия

1. Продавец авторизован в системе маркетплейса
2. Продавец имеет роль «Seller» с активным статусом

#### Основной поток

| # | Актор | Действие |
|---|-------|----------|
| 1 | Продавец | Нажимает кнопку «Добавить товар» в личном кабинете |
| 2 | Система | Отображает форму создания карточки товара с полями: название, описание, цена, фотографии |
| 3 | Продавец | Заполняет обязательные поля: название, описание, цена |
| 4 | Продавец | Загружает минимум 1 фотографию товара |
| 5 | Система | Валидирует загруженные фотографии (формат JPG/PNG, размер до 5 МБ, не более 10 шт.) |
| 6 | Продавец | Нажимает кнопку «Сохранить» |
| 7 | Система | Валидирует все обязательные поля (название 1–200 символов, описание 1–4000 символов, цена > 0) |
| 8 | Система | Сохраняет товар в статусе «Черновик» (Draft) |
| 9 | Система | Отображает подтверждение: «Карточка товара создана» и перенаправляет на страницу товара |

#### Альтернативные потоки

**AF-1: Ошибки валидации фотографий (шаг 5)**

5a. Фотография не соответствует требованиям (формат, размер, количество):
- Система отображает сообщение: «Файл [имя] не может быть загружен: [причина]»
- Продавец заменяет файл → возврат к шагу 4

**AF-2: Ошибки валидации полей (шаг 7)**

7a. Обязательные поля не заполнены или содержат некорректные данные:
- Система подсвечивает ошибочные поля и отображает сообщения
- Товар не сохраняется
- Продавец исправляет данные → возврат к шагу 3

**AF-3: Отмена создания (шаги 3–6)**

3a. Продавец нажимает «Отмена» или покидает страницу:
- Система отображает предупреждение: «Несохранённые данные будут потеряны. Продолжить?»
- При подтверждении — данные не сохраняются, возврат в список товаров
- При отмене — возврат к форме

#### Постусловия

**Успешное завершение:**
- Товар создан в статусе «Черновик»
- Товар отображается в списке товаров продавца
- Покупателям товар не виден

**При ошибке:**
- Товар не создан
- Продавец видит сообщения об ошибках

---

### UC-2: Сохранение черновика

| Поле | Значение |
|------|----------|
| **ID** | UC-2 |
| **Название** | Сохранение черновика товара |
| **Основной актор** | Продавец (Seller) |
| **Дополнительные акторы** | — |
| **Приоритет** | Средний |
| **Связанная User Story** | US-2 |

#### Предусловия

1. Продавец авторизован в системе маркетплейса
2. Продавец находится на форме создания или редактирования карточки товара
3. Товар находится в статусе «Черновик» (Draft) или создаётся впервые

#### Основной поток

| # | Актор | Действие |
|---|-------|----------|
| 1 | Продавец | Вносит изменения в поля карточки товара (любые поля, включая частичное заполнение) |
| 2 | Продавец | Нажимает кнопку «Сохранить черновик» |
| 3 | Система | Сохраняет текущее состояние карточки в статусе «Черновик» без валидации обязательных полей |
| 4 | Система | Отображает подтверждение: «Черновик сохранён» с указанием даты и времени сохранения |

#### Альтернативные потоки

**AF-1: Пустая форма (шаг 2)**

2a. Продавец пытается сохранить полностью пустую форму (ни одно поле не заполнено):
- Система отображает сообщение: «Заполните хотя бы одно поле для сохранения черновика»
- Возврат к шагу 1

**AF-2: Ошибка загрузки фотографий (шаг 1)**

1a. При загрузке фотографии произошла ошибка (сеть, формат):
- Система отображает ошибку у поля загрузки
- Текстовые поля остаются заполненными
- Продавец может сохранить черновик без фотографий → переход к шагу 2

**AF-3: Выход без сохранения (шаг 1–2)**

1b. Продавец покидает страницу без нажатия «Сохранить черновик»:
- Система отображает предупреждение: «У вас есть несохранённые изменения. Сохранить черновик?»
- «Сохранить» → переход к шагу 3
- «Не сохранять» → изменения теряются
- «Отмена» → возврат к редактированию

#### Постусловия

**Успешное завершение:**
- Товар сохранён в статусе «Черновик»
- Черновик виден только продавцу в списке его товаров
- Продавец может вернуться к редактированию в любое время

---

### UC-3: Публикация товара на маркетплейсе

| Поле | Значение |
|------|----------|
| **ID** | UC-3 |
| **Название** | Публикация товара на маркетплейсе |
| **Основной актор** | Продавец (Seller) |
| **Дополнительные акторы** | Сервис модерации, Система (Маркетплейс) |
| **Приоритет** | Высокий |
| **Связанная User Story** | US-3 |

#### Предусловия

1. Продавец авторизован в системе маркетплейса
2. Продавец имеет роль «Seller» с активным статусом
3. Существует товар в статусе «Черновик» (Draft), «Отклонён» (Rejected) или «Снят с публикации» (Unpublished)
4. Все обязательные поля товара заполнены (название, описание, цена, минимум 1 фотография)

#### Основной поток

| # | Актор | Действие |
|---|-------|----------|
| 1 | Продавец | Открывает карточку товара и нажимает кнопку «Опубликовать» |
| 2 | Система | Валидирует все обязательные поля (название, описание, цена, фотографии) |
| 3 | Система | Проверяет формат и размер загруженных фотографий (JPG/PNG, до 5 МБ) |
| 4 | Система | Меняет статус товара на «На модерации» (Pending Moderation) |
| 5 | Сервис модерации | Автоматически проверяет контент (текст, изображения) на соответствие правилам площадки |
| 6 | Система | Меняет статус товара на «Опубликован» (Published); товар становится видимым в каталоге |
| 7 | Система | Отправляет уведомление продавцу: «Ваш товар успешно опубликован» |

#### Альтернативные потоки

**AF-1: Ошибки валидации (шаг 2–3)**

2a. Если обязательные поля не заполнены или данные некорректны:
- Система отображает сообщения об ошибках у соответствующих полей
- Товар остаётся в текущем статусе
- Продавец исправляет данные → возврат к шагу 1

**AF-2: Сохранение как черновик (шаг 1)**

1a. Продавец нажимает «Сохранить черновик» вместо «Опубликовать»:
- Система сохраняет текущее состояние товара
- Товар остаётся / переходит в статус «Черновик»
- Выход из варианта использования

**AF-3: Отклонение модерацией (шаг 5)**

5a. Сервис модерации отклоняет контент:
- Статус товара меняется на «Отклонён» (Rejected)
- Система отправляет уведомление с причиной отклонения
- Продавец может отредактировать товар и повторить публикацию

**AF-4: Публикация из статуса «Отклонён» (предусловие)**

0a. Товар находится в статусе «Отклонён»:
- Продавец сначала редактирует карточку (статус меняется на «Черновик»)
- Далее выполняет публикацию по основному потоку

**AF-5: Публикация из статуса «Снят с публикации» (предусловие)**

0b. Товар находится в статусе «Снят с публикации»:
- Продавец нажимает «Опубликовать повторно»
- Товар отправляется на модерацию → переход к шагу 4

#### Постусловия

**Успешное завершение:**
- Товар имеет статус «Опубликован»
- Товар виден покупателям в каталоге маркетплейса
- Продавец получил подтверждающее уведомление

**При ошибке валидации:**
- Товар остаётся в текущем статусе
- Продавец видит сообщения об ошибках

**При отклонении модерацией:**
- Товар имеет статус «Отклонён»
- Продавец получил уведомление с причиной отказа

---

### UC-4: Редактирование товара

| Поле | Значение |
|------|----------|
| **ID** | UC-4 |
| **Название** | Редактирование карточки товара |
| **Основной актор** | Продавец (Seller) |
| **Дополнительные акторы** | Сервис модерации (при редактировании опубликованного товара) |
| **Приоритет** | Высокий |
| **Связанная User Story** | US-4 |

#### Предусловия

1. Продавец авторизован в системе маркетплейса
2. Существует товар, принадлежащий продавцу, в одном из статусов: «Черновик», «Опубликован», «Отклонён», «Снят с публикации»

#### Основной поток (редактирование опубликованного товара)

| # | Актор | Действие |
|---|-------|----------|
| 1 | Продавец | Открывает карточку товара в статусе «Опубликован» и нажимает «Редактировать» |
| 2 | Система | Отображает форму редактирования с текущими данными товара |
| 3 | Продавец | Вносит изменения в нужные поля (название, описание, цена, фотографии) |
| 4 | Продавец | Нажимает «Сохранить и отправить на модерацию» |
| 5 | Система | Валидирует все обязательные поля |
| 6 | Система | Сохраняет изменения; меняет статус на «На модерации» |
| 7 | Система | Покупателям продолжает отображаться предыдущая версия карточки |
| 8 | Сервис модерации | Проверяет обновлённый контент |
| 9 | Система | При успешной модерации — обновляет публичную версию карточки, статус «Опубликован» |
| 10 | Система | Отправляет уведомление продавцу о результате модерации |

#### Альтернативные потоки

**AF-1: Редактирование черновика (шаг 1)**

1a. Товар в статусе «Черновик»:
- Продавец редактирует поля
- Нажимает «Сохранить черновик» → товар остаётся в статусе «Черновик»
- Модерация не требуется

**AF-2: Редактирование отклонённого товара (шаг 1)**

1b. Товар в статусе «Отклонён»:
- Продавец редактирует поля, устраняя причину отклонения
- Нажимает «Сохранить» → статус меняется на «Черновик»
- Далее продавец может опубликовать товар заново (UC-3)

**AF-3: Ошибки валидации (шаг 5)**

5a. Данные не прошли валидацию:
- Система отображает ошибки у соответствующих полей
- Изменения не сохраняются
- Продавец исправляет данные → возврат к шагу 3

**AF-4: Отмена редактирования (шаг 3)**

3a. Продавец нажимает «Отмена»:
- Система отображает предупреждение: «Несохранённые изменения будут потеряны»
- При подтверждении — возврат к просмотру карточки без изменений

**AF-5: Отклонение модерацией (шаг 8)**

8a. Модерация отклоняет обновлённый контент:
- Статус товара меняется на «Отклонён»
- Покупателям перестаёт отображаться предыдущая версия (товар скрыт)
- Продавец получает уведомление с причиной отклонения

#### Постусловия

**Успешное завершение (опубликованный товар):**
- Публичная версия карточки обновлена
- Товар имеет статус «Опубликован»
- Продавец получил уведомление

**Успешное завершение (черновик):**
- Черновик обновлён
- Статус остаётся «Черновик»

**При отклонении модерацией:**
- Товар имеет статус «Отклонён»
- Продавец получил уведомление с причиной

---

### UC-5: Снятие товара с публикации

| Поле | Значение |
|------|----------|
| **ID** | UC-5 |
| **Название** | Снятие товара с публикации |
| **Основной актор** | Продавец (Seller) |
| **Дополнительные акторы** | — |
| **Приоритет** | Средний |
| **Связанная User Story** | US-5 |

#### Предусловия

1. Продавец авторизован в системе маркетплейса
2. Существует товар в статусе «Опубликован» (Published), принадлежащий продавцу

#### Основной поток

| # | Актор | Действие |
|---|-------|----------|
| 1 | Продавец | Открывает карточку опубликованного товара |
| 2 | Продавец | Нажимает кнопку «Снять с публикации» |
| 3 | Система | Отображает диалог подтверждения: «Товар будет скрыт из каталога. Существующие заказы не будут отменены. Продолжить?» |
| 4 | Продавец | Подтверждает действие |
| 5 | Система | Меняет статус товара на «Снят с публикации» (Unpublished) |
| 6 | Система | Скрывает товар из каталога для покупателей |
| 7 | Система | Отображает подтверждение: «Товар снят с публикации» |

#### Альтернативные потоки

**AF-1: Отмена действия (шаг 4)**

4a. Продавец нажимает «Отмена» в диалоге подтверждения:
- Товар остаётся в статусе «Опубликован»
- Возврат к просмотру карточки

**AF-2: Наличие активных заказов (шаг 5)**

5a. У товара есть активные (неотправленные) заказы:
- Система отображает предупреждение: «У товара есть N активных заказов. Они не будут отменены. Продолжить?»
- При подтверждении — товар снимается с публикации, заказы обрабатываются в штатном режиме
- При отмене — возврат к просмотру карточки

**AF-3: Повторная публикация (после снятия)**

7a. Продавец хочет повторно опубликовать товар:
- На странице снятого товара доступна кнопка «Опубликовать повторно»
- Переход к UC-3 (шаг 4 — отправка на модерацию)

#### Постусловия

**Успешное завершение:**
- Товар имеет статус «Снят с публикации»
- Товар не отображается покупателям в каталоге
- Существующие заказы не отменены
- Продавец видит товар в своём списке и может его повторно опубликовать

**При отмене:**
- Товар остаётся в статусе «Опубликован»
- Никаких изменений не произведено
